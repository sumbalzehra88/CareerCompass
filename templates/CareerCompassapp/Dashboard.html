<html lang="en">
<head>
    {% load static %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CareerCompass Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: linear-gradient(135deg, #CDFCFF 0%, #B2FAFF 100%); font-family: sans-serif; }

        .navbar { display: flex; justify-content: space-between; align-items: center; padding: 20px 40px; margin: 20px; background: #fff; border-radius: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); height: 80px; overflow: hidden; }
        .logo { display: flex; align-items: center; font-size: 48px; font-weight: 700; color: #1a202c; text-decoration: none; transition: transform 0.3s ease; height: 100%; }
        .logo:hover { transform: scale(1.05); }
        .logo-icon { width: 300px; height: 300px; margin-right: 12px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; margin-top: 85px; }
        .logo-icon img { width: 100%; height: 100%; object-fit: contain; }
        .nav-links { display: flex; gap: 30px; align-items: center; }
        .nav-links a { color: #1a202c; text-decoration: none; font-weight: 500; font-size: 16px; padding: 8px 16px; border-radius: 20px; transition: all 0.3s ease; }
        .nav-links a:hover { background: rgba(0,180,216,0.1); color: #0077b6; }

        .main-container { display: flex; gap: 20px; padding: 20px; max-width: 1400px; margin: 0 auto; min-height: calc(100vh - 200px); }
        .left-sidebar, .right-sidebar { width: 270px; display: flex; flex-direction: column; gap: 20px; flex-shrink: 0; }
        .center-content { flex: 1; display: flex; flex-direction: column; gap: 25px; min-width: 0; }

        .welcome-section h2 { font-size: 26px; color: #000; margin-bottom: 8px; font-weight: 600; }
        .welcome-section p { color: #666; font-size: 13px; line-height: 1.4; }

        .notifications-section { background: #fff; border-radius: 12px; padding: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); max-height: 150px; overflow-y: auto; }
        .notifications-section h3 { font-size: 16px; margin-bottom: 10px; color: #0077b6; }
        .notification-item { font-size: 13px; color: #333; padding: 6px 8px; border-bottom: 1px solid rgba(0,0,0,0.05); }
        .notification-item:last-child { border-bottom: none; }

        .progress-section h3 { font-size: 18px; color: #000; margin-bottom: 15px; font-weight: 600; }
        .progress-card { background: linear-gradient(135deg, #00b4d8 0%, #0077b6 100%); border-radius: 12px; padding: 20px; color: white; margin-bottom: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .progress-circle { width: 85px; height: 85px; border-radius: 50%; border: 6px solid rgba(255,255,255,0.3); border-top-color: white; display: flex; align-items: center; justify-content: center; font-size: 18px; font-weight: bold; margin-bottom: 12px; }
        .progress-label { font-size: 13px; opacity: 0.95; font-weight: 500; }
        .progress-details { font-size: 11px; opacity: 0.85; margin-top: 5px; }

        .internships-section, .hackathons-section { background: linear-gradient(135deg, #00b4d8 0%, #0077b6 100%); border-radius: 15px; padding: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .section-title { color: #fff; font-size: 18px; font-weight: bold; margin-bottom: 20px; }
        .slider-container { position: relative; overflow: hidden; padding: 0 50px; margin: 0 -25px; }
        .cards-slider { display: flex; gap: 20px; transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94); padding: 10px 0; }
        .card { background: linear-gradient(135deg, #0077b6 0%, #005577 50%, #014970 100%); border-radius: 15px; height: 110px; min-width: 220px; display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; font-size: 14px; text-align: center; font-weight: 500; transition: all 0.3s ease; cursor: pointer; box-shadow: 0 8px 25px rgba(8,145,178,0.25); position: relative; overflow: hidden; border: 1px solid rgba(255,255,255,0.1); }
        .card-applied { position: absolute; top: 8px; right: 8px; background: green; color: white; font-size: 10px; font-weight: bold; padding: 2px 6px; border-radius: 8px; }
        .slider-btn { position: absolute; top: 50%; transform: translateY(-50%); background: linear-gradient(135deg, #fff 0%, #f8fafc 100%); border: 2px solid rgba(8,145,178,0.2); width: 45px; height: 45px; border-radius: 50%; cursor: pointer; font-size: 18px; font-weight: bold; color: #0891b2; z-index: 10; }
        .slider-btn.prev { left: 10px; }
        .slider-btn.next { right: 10px; }
        .slider-btn.prev::before { content: '‚Äπ'; }
        .slider-btn.next::before { content: '‚Ä∫'; }

        .footer { background: #014970; color: white; text-align: center; padding: 20px; font-size: 13px; }
        .empty-state { text-align: center; padding: 30px; color: rgba(255,255,255,0.8); font-size: 14px; }
    </style>
</head>
<body>
    <!-- NAVBAR -->
    <nav class="navbar">
        <a href="{% url 'home' %}" class="logo">
            <div class="logo-icon"><img src="{% static 'CareerCompassapp/logo.png' %}" alt="CC Logo"></div>
        </a>
        <div class="nav-links">
            <a href="{% url 'home' %}">Home</a>
            <a href="{% url 'contact' %}">Contact</a>
            <a href="{% url 'dashboard' %}">Dashboard</a>
        </div>
    </nav>

    <div class="main-container">
        <div class="left-sidebar">
            <div class="welcome-section">
                <h2 id="userGreeting">Hello, XYZ</h2>
                <p>Nice to have you back. Here is a summary of your activity.</p>
            </div>

            <!-- Notifications Section -->
            <div class="notifications-section" id="notificationsSidebar">
                <h3>Notifications</h3>
                <div class="notification-item">‚è≥ Deadline approaching! Frontend Developer Internship at TechNova Inc. ends tomorrow.</div>
            </div>

            <div class="progress-section">
                <h3>Your Progress</h3>
                <div class="progress-card">
                    <div class="progress-circle" id="roadmapProgress">0%</div>
                    <div class="progress-label">Roadmaps</div>
                    <div class="progress-details" id="roadmapDetails">Loading...</div>
                </div>
            </div>
        </div>

        <div class="center-content">
            <div class="internships-section">
                <div class="section-title">Internships</div>
                <div class="slider-container">
                    <button class="slider-btn prev" onclick="slideInternships(-1)"></button>
                    <div class="cards-slider" id="internshipsSlider">
                        <div class="loading empty-state">Loading your internships...</div>
                    </div>
                    <button class="slider-btn next" onclick="slideInternships(1)"></button>
                </div>
            </div>

            <div class="hackathons-section">
                <div class="section-title">Hackathons</div>
                <div class="slider-container">
                    <button class="slider-btn prev" onclick="slideHackathons(-1)"></button>
                    <div class="cards-slider" id="hackathonsSlider">
                        <div class="loading empty-state">Loading your hackathons...</div>
                    </div>
                    <button class="slider-btn next" onclick="slideHackathons(1)"></button>
                </div>
            </div>
        </div>
    </div>

    <footer class="footer">¬© 2025 CareerCompass. All rights reserved.</footer>

    <script>
        const csrftoken = (name = 'csrftoken') => document.cookie.split('; ').find(row => row.startsWith(name+'='))?.split('=')[1];

        async function loadDashboard() {
            try {
                const res = await fetch('/api/dashboard/', { headers: { 'X-CSRFToken': csrftoken() } });
                const data = await res.json();

                const userName = data.profile?.name || 'XYZ';
                document.getElementById('userGreeting').textContent = `Hello, ${userName}`;

                loadInternships(data.internships || []);
                loadHackathons(data.hackathons || []);
                loadProgress(data.roadmaps || []);
            } catch(e) { console.error(e); }
        }

        function loadInternships(list) {
            const slider = document.getElementById('internshipsSlider');
            slider.innerHTML = '';

            if (!list.length) {
                list = [{
                    id: 0,
                    title: "Frontend Developer Internship",
                    company: "TechNova Inc.",
                    location: "Remote",
                    deadline: "2025-12-31",
                    status: "Pending",
                    applied_on: new Date().toISOString().split('T')[0]
                }];
            }

            const applied = JSON.parse(localStorage.getItem('appliedInternships')) || [];

            list.forEach(i => {
                const card = document.createElement('div'); 
                card.className = 'card';
                const appliedTag = applied.includes(i.id) ? '<div class="card-applied">Applied ‚úÖ</div>' : '';
                card.innerHTML = `
                    <div class="card-icon">üíº</div>
                    <div class="card-title">${i.title}</div>
                    <div class="card-company">${i.company}</div>
                    ${appliedTag}
                `;
                slider.appendChild(card);
            });
        }

        function loadHackathons(list) {
            const slider = document.getElementById('hackathonsSlider');
            slider.innerHTML = '';
            if (!list.length) { slider.innerHTML = '<div class="empty-state">No hackathons registered yet</div>'; return; }
            list.forEach(h => {
                const card = document.createElement('div'); card.className = 'card';
                card.innerHTML = `<div class="card-icon">üèÜ</div><div class="card-title">${h.name}</div><div class="card-company">${h.team_name || 'Solo'}</div>`;
                slider.appendChild(card);
            });
        }

        function loadProgress(roadmaps) {
            const count = roadmaps.length;
            const percent = Math.min(Math.round((count/7)*100),100);
            document.getElementById('roadmapProgress').textContent = `${percent}%`;
            document.getElementById('roadmapDetails').textContent = `${count} roadmaps selected`;
        }

        window.addEventListener('DOMContentLoaded', loadDashboard);
    </script>
</body>
</html>
